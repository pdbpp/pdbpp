image: Visual Studio 2019
environment:
  PYTEST_ADDOPTS: "-vv --cov-report=xml:coverage-ci.xml"
  CODECOV_FLAG: "windows"

  matrix:
    - TOXENV: py27-coverage
      PYTEST: "pytest @ git+https://github.com/blueyed/pytest@my-4.6-maintenance"
    - TOXENV: py38-coverage
      PYTEST: "pytest @ git+https://github.com/blueyed/pytest@my-master"

build: off

install:
  - C:\Python39\python.exe --version --version
  - C:\Python39\python.exe -m pip --version
  - C:\Python39\python.exe -m pip install --user git+https://github.com/blueyed/tox@master
  - C:\Python39\python.exe -m pip freeze
  - C:\Python39\python.exe -m pip freeze --user
  - C:\Python39\python.exe -m tox -v --notest --force-dep="%PYTEST%"

test_script:
  - C:\Python39\python.exe -m tox --force-dep="%PYTEST%"

on_finish:
  - bash .ci/report-coverage.sh -n "%TOXENV%-Windows" -F AppVeyor,Windows
